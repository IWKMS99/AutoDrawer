# AutoDrawer

**⚠️ Внимание: Этот проект находится в активной разработке и может содержать ошибки. Стабильность работы не гарантируется.**

AutoDrawer — это Python-бот, предназначенный для автоматического "рисования" изображений в различных графических приложениях (например, онлайн-играх с пиксельным рисованием, простых редакторах) путем эмуляции движений и кликов мыши. Он анализирует входное изображение, определяет доступные цвета на палитре в целевом приложении, находит холст и пытается воспроизвести изображение пиксель за пикселем.

**Цель проекта:** Создать удобный инструмент для автоматизации рутинного рисования по пикселям. Мы ищем контрибьюторов для улучшения стабильности, добавления новых функций и исправления ошибок!

## Возможности

* **Загрузка и обработка изображений:** Уменьшение изображения до заданного разрешения (сетки холста) с сохранением пропорций, поворот при необходимости.
* **Квантование цветов:** Уменьшение количества цветов изображения с помощью K-Means для соответствия ограниченной палитре.
* **Автоматическое определение:** Попытка автоматически найти область холста и палитру на экране.
* **Ручная настройка:** Возможность указать области холста и палитры вручную с помощью кликов мыши.
* **Анализ палитры:** Извлечение доступных цветов и их координат на экране из заданной области палитры (используя детекцию кругов или K-Means как fallback).
* **Сопоставление цветов:** Нахождение наиболее подходящих цветов из палитры для цветов исходного изображения (используется цветовое пространство LAB для большей точности).
* **Автоматическое рисование:** Управление курсором мыши для выбора нужного цвета на палитре и клика в соответствующей ячейке холста.
* **Оптимизация порядка рисования:** Сортировка пикселей для минимизации переключений между цветами.
* **Очистка холста:** Возможность автоматической очистки холста перед рисованием с использованием найденного или указанного инструмента "ластик".
* **Интерактивная настройка:** Пошаговая настройка через консоль и клики мыши.
* **Управление процессом:** Пауза (Пробел) и полная остановка (Esc) во время работы.
* **Поддержка нескольких мониторов:** Возможность выбрать монитор для работы.
* **Конфигурация:** Настройка различных параметров (задержки, параметры детекции) через файл `config/settings.yaml`.
* **Режим отладки:** Визуализация шагов обработки (пороговые изображения, найденные контуры, предпросмотр) с помощью OpenCV.

## Установка

1.  **Клонируйте репозиторий:**
    ```bash
    git clone <URL вашего репозитория>
    cd AutoDrawer
    ```
2.  **Создайте и активируйте виртуальное окружение** (рекомендуется):
    ```bash
    # Windows
    python -m venv venv
    .\venv\Scripts\activate

    # macOS/Linux
    python3 -m venv venv
    source venv/bin/activate
    ```
3.  **Установите зависимости:**
    ```bash
    pip install -r requirements.txt
    ```
    *Примечание: Убедитесь, что у вас установлен Python 3.x.*

## Использование

1.  **Запустите скрипт из командной строки:**
    ```bash
    python main.py <путь_к_вашему_изображению> [опции]
    ```
    * `<путь_к_вашему_изображению>`: Обязательный аргумент, указывающий на файл изображения, которое вы хотите нарисовать.

2.  **Опции командной строки:**
    * `--clear`: Очистить холст перед рисованием (потребуется указать ластик во время настройки).
    * `--debug`: Включить режим отладки (будут показаны окна OpenCV с промежуточными результатами).
    * `--monitor <номер>`: Указать номер монитора для захвата (0 - основной, 1, 2... - дополнительные). Если не указано, будет предложено выбрать интерактивно.

3.  **Интерактивная настройка:**
    * Если монитор не был указан через опцию, вам будет предложено выбрать его из списка.
    * Следуйте инструкциям в консоли для настройки:
        * **Определение холста:** Скрипт попытается найти холст автоматически. Если не получится, вам будет предложено выбрать его двумя кликами (верхний левый и нижний правый углы).
        * **Определение палитры:** Аналогично, скрипт попытается найти палитру и ластик (если запрошена очистка). При неудаче потребуется выбрать область палитры двумя кликами и указать на ластик отдельным кликом.
        * **Параметры:** Введите ожидаемое количество цветов в палитре и подтвердите или измените задержки для кликов.
        * **Предпросмотр:** Будет показано окно с тем, как изображение будет выглядеть после обработки (уменьшение размера, квантование цветов). Нажмите `Пробел` в окне предпросмотра для подтверждения или `Esc` для отмены.

4.  **Начало рисования:**
    * После подтверждения предпросмотра у вас будет **5 секунд**, чтобы переключиться на окно приложения, где вы хотите рисовать.
    * Скрипт начнет рисовать.
    * Вы можете **приостановить/возобновить** рисование, нажав `Пробел`.
    * Вы можете **остановить** скрипт в любой момент, нажав `Esc`.

## Конфигурация

Основные параметры работы бота можно настроить в файле `config/settings.yaml`. Это включает:

* Задержки между кликами (`click_delay`, `color_change_delay`, `clear_click_delay`).
* Параметры автоматического определения холста (`canvas_detection.*`).
* Количество цветов по умолчанию (`num_colors`).
* Целевое разрешение по умолчанию (`target_width` - используется как максимальная ширина/высота при уменьшении).

## Зависимости

Все необходимые библиотеки перечислены в файле `requirements.txt`. Ключевые зависимости включают:

* `opencv-python`: Для обработки изображений и отладки.
* `numpy`: Для численных операций.
* `Pillow`: Для загрузки и базовой обработки изображений.
* `pyautogui`: Для управления мышью.
* `pynput`: Для отслеживания нажатий клавиатуры (пауза/стоп) и мыши (настройка).
* `mss`: Для эффективного захвата экрана.
* `scikit-learn`: Для кластеризации цветов (K-Means).
* `scikit-image`: Для сравнения цветов в LAB пространстве.
* `PyYAML`: Для загрузки конфигурации.
* `tqdm`: Для отображения прогресс-бара.

## Как внести вклад (Contributing)

**Мы будем очень рады вашей помощи!** Если вы хотите улучшить AutoDrawer:

1.  **Сделайте форк** репозитория.
2.  **Создайте новую ветку** для ваших изменений (`git checkout -b feature/ваша-фича` или `bugfix/описание-бага`).
3.  **Внесите свои изменения.**
4.  **Закоммитьте изменения** (`git commit -m 'Понятное описание ваших изменений'`).
5.  **Отправьте изменения** в ваш форк (`git push origin feature/ваша-фича`).
6.  **Создайте Pull Request** в основной репозиторий с описанием ваших изменений.

Пожалуйста, сообщайте о найденных ошибках или предлагайте идеи через **Issues** в репозитории.

## Известные проблемы и ограничения

* **Автоматическое определение холста и палитры** может работать нестабильно в зависимости от приложения, разрешения экрана и темы ОС. Ручная настройка часто более надежна.
* **Точность K-Means** зависит от исходного изображения и выбранного количества цветов.
* **Сопоставление цветов** не всегда идеально, особенно если в палитре нет близких оттенков.
* **Скорость рисования** ограничена задержками, необходимыми для корректной работы в целевом приложении.
* **Совместимость:** Проект тестировался ограниченно. Могут быть проблемы с разными ОС или специфическими приложениями для рисования.
* **Ошибки:** Как упоминалось, проект содержит баги. Используйте на свой страх и риск.

## Лицензия

TBD